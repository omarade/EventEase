ô
FE:\Work\Repos\EventEase\UserService\Consumers\ClientCreatedConsumer.cs
	namespace 	
UserService
 
. 
	Consumers 
{ 
public		 

class		 !
ClientCreatedConsumer		 &
:		& '
	IConsumer		( 1
<		1 2
ClientCreated		2 ?
>		? @
{

 
private 
readonly 
ILogger  
<  !
ClientCreated! .
>. /
_logger0 7
;7 8
private 
readonly 
IClientRepo $
_clientRepo% 0
;0 1
private 
readonly 
IMapper  
_mapper! (
;( )
public !
ClientCreatedConsumer $
($ %
ILogger% ,
<, -
ClientCreated- :
>: ;
logger< B
,B C
IClientRepoD O

clientRepoP Z
,Z [
IMapper\ c
mapperd j
)j k
{ 	
_logger 
= 
logger 
; 
_mapper 
= 
mapper 
; 
_clientRepo 
= 

clientRepo $
;$ %
} 	
public 
async 
Task 
Consume !
(! "
ConsumeContext" 0
<0 1
ClientCreated1 >
>> ?
context@ G
)G H
{ 	
var 
clientCreated 
= 
context  '
.' (
Message( /
;/ 0
_logger 
. 
LogInformation "
(" #
$"# %
$str% ;
{; <
clientCreated< I
.I J
NameJ N
}N O
"O P
)P Q
;Q R
var   
clientModel   
=   
_mapper   %
.  % &
Map  & )
<  ) *
Client  * 0
>  0 1
(  1 2
clientCreated  2 ?
)  ? @
;  @ A
_clientRepo"" 
."" 
CreateClient"" $
(""$ %
clientModel""% 0
)""0 1
;""1 2
await$$ 
_clientRepo$$ 
.$$ 
SaveChanges$$ )
($$) *
)$$* +
;$$+ ,
}%% 	
}&& 
}'' Þ
EE:\Work\Repos\EventEase\UserService\Consumers\VenueCreatedConsumer.cs
	namespace 	
UserService
 
. 
	Consumers 
{ 
public		 

class		  
VenueCreatedConsumer		 %
:		& '
	IConsumer		( 1
<		1 2
VenueCreated		2 >
>		> ?
{

 
private 
readonly 
ILogger  
<  !
VenueCreated! -
>- .
_logger/ 6
;6 7
private 
readonly 

IVenueRepo #

_venueRepo$ .
;. /
private 
readonly 
IMapper  
_mapper! (
;( )
public  
VenueCreatedConsumer #
(# $
ILogger$ +
<+ ,
VenueCreated, 8
>8 9
logger: @
,@ A

IVenueRepoB L
	venueRepoM V
,V W
IMapperX _
mapper` f
)f g
{ 	
_logger 
= 
logger 
; 
_mapper 
= 
mapper 
; 

_venueRepo 
= 
	venueRepo "
;" #
} 	
public 
async 
Task 
Consume !
(! "
ConsumeContext" 0
<0 1
VenueCreated1 =
>= >
context? F
)F G
{ 	
var 
venueCreated 
= 
context &
.& '
Message' .
;. /
_logger 
. 
LogInformation "
(" #
$"# %
$str% ;
{; <
venueCreated< H
.H I
NameI M
}M N
"N O
)O P
;P Q
var   

venueModel   
=   
_mapper   $
.  $ %
Map  % (
<  ( )
Venue  ) .
>  . /
(  / 0
venueCreated  0 <
)  < =
;  = >

_venueRepo"" 
."" 
CreateVenue"" "
(""" #

venueModel""# -
)""- .
;"". /
await$$ 

_venueRepo$$ 
.$$ 
SaveChanges$$ (
($$( )
)$$) *
;$$* +
}%% 	
}&& 
}'' ½\
DE:\Work\Repos\EventEase\UserService\Controllers\ClientsController.cs
	namespace 	
UserService
 
. 
Controllers !
{ 
[ 
Route 

(
 
$str #
)# $
]$ %
[ 
ApiController 
] 
public 

class 
ClientsController "
:# $
ControllerBase% 3
{ 
private 
readonly 
IClientRepo $
_clientRepo% 0
;0 1
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
IPublishEndpoint )
_publishEndpoint* :
;: ;
public 
ClientsController  
(  !
IClientRepo! ,

clientRepo- 7
,7 8
IMapper9 @
mapperA G
,G H
IPublishEndpoint 
publishEndpoint ,
), -
{ 	
_clientRepo 
= 

clientRepo $
;$ %
_mapper 
= 
mapper 
; 
_publishEndpoint 
= 
publishEndpoint .
;. /
} 	
[ 	
HttpGet	 
] 
[   	
	Authorize  	 
(   !
AuthenticationSchemes   (
=  ) *
JwtBearerDefaults  + <
.  < = 
AuthenticationScheme  = Q
,  Q R
Roles  S X
=  Y Z
$str  [ b
)  b c
]  c d
public!! 
async!! 
Task!! 
<!! 
ActionResult!! &
<!!& '
IEnumerable!!' 2
<!!2 3
ClientReadDto!!3 @
>!!@ A
>!!A B
>!!B C

GetClients!!D N
(!!N O
int!!O R
pageSize!!S [
=!!\ ]
$num!!^ `
,!!` a
int!!b e

pageNumber!!f p
=!!q r
$num!!s t
)!!t u
{"" 	
Console## 
.## 
	WriteLine## 
(## 
$str## 8
)##8 9
;##9 :
var%% 
clients%% 
=%% 
await%% 
_clientRepo%%  +
.%%+ ,
GetAllClients%%, 9
(%%9 :
pageSize%%: B
,%%B C

pageNumber%%D N
)%%N O
;%%O P
return'' 
Ok'' 
('' 
_mapper'' 
.'' 
Map'' !
<''! "
IEnumerable''" -
<''- .
ClientReadDto''. ;
>''; <
>''< =
(''= >
clients''> E
)''E F
)''F G
;''G H
}(( 	
[** 	
HttpGet**	 
(** 
$str** 
,** 
Name** 
=** 
$str**  /
)**/ 0
]**0 1
[++ 	
	Authorize++	 
(++ !
AuthenticationSchemes++ (
=++) *
JwtBearerDefaults+++ <
.++< = 
AuthenticationScheme++= Q
)++Q R
]++R S
public,, 
async,, 
Task,, 
<,, 
ActionResult,, &
<,,& '
ClientReadDto,,' 4
>,,4 5
>,,5 6
GetClientById,,7 D
(,,D E
int,,E H
id,,I K
),,K L
{-- 	
Console.. 
... 
	WriteLine.. 
(.. 
$str.. =
+..> ?
id..@ B
)..B C
;..C D
string11 
clientId11 
=11 
this11 "
.11" #
User11# '
.11' (
GetId11( -
(11- .
)11. /
;11/ 0
var33 
client33 
=33 
await33 
_clientRepo33 *
.33* +
GetClientById33+ 8
(338 9
id339 ;
)33; <
;33< =
if55 
(55 
client55 
!=55 
null55 
)55 
{66 
if77 
(77 
clientId77 
!=77 
client77  &
.77& '

ExternalId77' 1
)771 2
{88 
return99 
Unauthorized99 '
(99' (
)99( )
;99) *
}:: 
return<< 
Ok<< 
(<< 
_mapper<< !
.<<! "
Map<<" %
<<<% &
ClientReadDto<<& 3
><<3 4
(<<4 5
client<<5 ;
)<<; <
)<<< =
;<<= >
}== 
else>> 
{?? 
return@@ 
NotFound@@ 
(@@  
)@@  !
;@@! "
}AA 
}BB 	
[DD 	
HttpGetDD	 
(DD 
$strDD #
,DD# $
NameDD% )
=DD* +
$strDD, >
)DD> ?
]DD? @
publicEE 
asyncEE 
TaskEE 
<EE 
ActionResultEE &
<EE& '
ClientReadDtoEE' 4
>EE4 5
>EE5 6
GetClientByEmailEE7 G
(EEG H
stringEEH N
emailEEO T
)EET U
{FF 	
ConsoleGG 
.GG 
	WriteLineGG 
(GG 
$strGG @
+GGA B
emailGGC H
)GGH I
;GGI J
stringJJ 
clientIdJJ 
=JJ 
thisJJ "
.JJ" #
UserJJ# '
.JJ' (
GetIdJJ( -
(JJ- .
)JJ. /
;JJ/ 0
varLL 
clientLL 
=LL 
awaitLL 
_clientRepoLL *
.LL* +
GetClientByEmailLL+ ;
(LL; <
emailLL< A
)LLA B
;LLB C
ifNN 
(NN 
clientIdNN 
!=NN 
clientNN "
.NN" #

ExternalIdNN# -
)NN- .
{OO 
returnPP 
UnauthorizedPP #
(PP# $
)PP$ %
;PP% &
}QQ 
ifSS 
(SS 
clientSS 
!=SS 
nullSS 
)SS 
{TT 
returnUU 
OkUU 
(UU 
_mapperUU !
.UU! "
MapUU" %
<UU% &
ClientReadDtoUU& 3
>UU3 4
(UU4 5
clientUU5 ;
)UU; <
)UU< =
;UU= >
}VV 
elseWW 
{XX 
returnYY 
NotFoundYY 
(YY  
)YY  !
;YY! "
}ZZ 
}[[ 	
[]] 
HttpPut]] 
(]] 
$str]] 
)]] 
]]] 
[^^ 
	Authorize^^ 
(^^ !
AuthenticationSchemes^^ '
=^^( )
JwtBearerDefaults^^* ;
.^^; < 
AuthenticationScheme^^< P
)^^P Q
]^^Q R
public__ 
async__ 
Task__ 
<__ 
ActionResult__ %
<__% &
ClientUpdateDto__& 5
>__5 6
>__6 7
UpdateClient__8 D
(__D E
int__E H
id__I K
,__K L
ClientUpdateDto__M \
clientUpdateDto__] l
)__l m
{`` 
stringbb 
clientIdbb 
=bb 
thisbb "
.bb" #
Userbb# '
.bb' (
GetIdbb( -
(bb- .
)bb. /
;bb/ 0
vardd 
clientdd 
=dd 
awaitdd 
_clientRepodd *
.dd* +
GetClientByIddd+ 8
(dd8 9
iddd9 ;
)dd; <
;dd< =
ifff 
(ff 
clientff 
isff 
nullff 
)ff 
{gg 
returnhh 
NotFoundhh 
(hh  
$"hh  "
$strhh" ;
"hh; <
)hh< =
;hh= >
}ii 
ifkk 
(kk 
clientIdkk 
!=kk 
clientkk "
.kk" #

ExternalIdkk# -
)kk- .
{ll 
returnmm 
Unauthorizedmm #
(mm# $
)mm$ %
;mm% &
}nn 
clientqq 
.qq 
Nameqq 
=qq 
clientUpdateDtoqq )
.qq) *
Nameqq* .
;qq. /
_clientReposs 
.ss 
UpdateClientss $
(ss$ %
clientss% +
)ss+ ,
;ss, -
iftt 
(tt 
awaittt 
_clientRepott  
.tt  !
SaveChangestt! ,
(tt, -
)tt- .
)tt. /
{uu 
Consolevv 
.vv 
	WriteLinevv !
(vv! "
$strvv" G
)vvG H
;vvH I
varww 
clientUpdatedww !
=ww" #
_mapperww$ +
.ww+ ,
Mapww, /
<ww/ 0
ClientUpdatedww0 =
>ww= >
(ww> ?
clientww? E
)wwE F
;wwF G
awaityy 
_publishEndpointyy &
.yy& '
Publishyy' .
<yy. /
ClientUpdatedyy/ <
>yy< =
(yy= >
clientUpdatedyy> K
)yyK L
;yyL M
}zz 
return|| 
	NoContent|| 
(|| 
)|| 
;|| 
}}} 
[ 

HttpDelete 
( 
$str 
) 
] 
[
 
	Authorize
 
(
 #
AuthenticationSchemes
 '
=
( )
JwtBearerDefaults
* ;
.
; <"
AuthenticationScheme
< P
)
P Q
]
Q R
public
 
async
 
Task
 
<
 
ActionResult
 %
>
% &
DeleteClient
' 3
(
3 4
int
4 7
id
8 :
)
: ;
{
 
string
 
clientId
 
=
 
this
 "
.
" #
User
# '
.
' (
GetId
( -
(
- .
)
. /
;
/ 0
var
 
client
 
=
 
await
 
_clientRepo
 *
.
* +
GetClientById
+ 8
(
8 9
id
9 ;
)
; <
;
< =
if
 
(
 
client
 
is
 
null
 
)
 
{
 
return
 
NotFound
 
(
  
$"
  "
$str
" ;
"
; <
)
< =
;
= >
}
 
if
 
(
 
clientId
 
!=
 
client
 "
.
" #

ExternalId
# -
)
- .
{
 
return
 
Unauthorized
 #
(
# $
)
$ %
;
% &
}
 
var
 
clientDeleted
 
=
 
_mapper
  '
.
' (
Map
( +
<
+ ,
ClientDeleted
, 9
>
9 :
(
: ;
client
; A
)
A B
;
B C
_clientRepo
 
.
 
DeleteClient
 $
(
$ %
client
% +
)
+ ,
;
, -
if
 
(
 
await
 
_clientRepo
  
.
  !
SaveChanges
! ,
(
, -
)
- .
)
. /
{
 
await
 
_publishEndpoint
 &
.
& '
Publish
' .
<
. /
ClientDeleted
/ <
>
< =
(
= >
clientDeleted
> K
)
K L
;
L M
}
 
return
 
Ok
 
(
 
)
 
;
 
}
 
}
 
} §I
CE:\Work\Repos\EventEase\UserService\Controllers\VenuesController.cs
	namespace 	
UserService
 
. 
Controllers !
{ 
[ 
Route 

(
 
$str #
)# $
]$ %
[ 
ApiController 
] 
public 

class 
VenuesController !
:" #
ControllerBase$ 2
{ 
private 
readonly 

IVenueRepo #

_venueRepo$ .
;. /
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
IPublishEndpoint )
_publishEndpoint* :
;: ;
public 
VenuesController 
(  

IVenueRepo  *
	venueRepo+ 4
,4 5
IMapper6 =
mapper> D
,D E
IPublishEndpointF V
publishEndpointW f
)f g
{ 	

_venueRepo 
= 
	venueRepo "
;" #
_mapper 
= 
mapper 
; 
_publishEndpoint 
= 
publishEndpoint .
;. /
} 	
[ 	
HttpGet	 
] 
[ 	
	Authorize	 
( !
AuthenticationSchemes (
=) *
JwtBearerDefaults+ <
.< = 
AuthenticationScheme= Q
,Q R
RolesS X
=Y Z
$str[ b
)b c
]c d
public 
async 
Task 
< 
ActionResult &
<& '
IEnumerable' 2
<2 3
VenueReadDto3 ?
>? @
>@ A
>A B
	GetVenuesC L
(L M
intM P
pageSizeQ Y
=Z [
$num\ ^
,^ _
int` c

pageNumberd n
=o p
$numq r
)r s
{ 	
Console   
.   
	WriteLine   
(   
$str   7
)  7 8
;  8 9
var"" 
venues"" 
="" 
await"" 

_venueRepo"" )
."") *
GetAllVenues""* 6
(""6 7
pageSize""7 ?
,""? @

pageNumber""A K
)""K L
;""L M
return$$ 
Ok$$ 
($$ 
_mapper$$ 
.$$ 
Map$$ !
<$$! "
IEnumerable$$" -
<$$- .
VenueReadDto$$. :
>$$: ;
>$$; <
($$< =
venues$$= C
)$$C D
)$$D E
;$$E F
}%% 	
['' 	
HttpGet''	 
('' 
$str'' 
,'' 
Name'' 
='' 
$str''  .
)''. /
]''/ 0
public(( 
async(( 
Task(( 
<(( 
ActionResult(( &
<((& '
VenueReadDto((' 3
>((3 4
>((4 5
GetVenueById((6 B
(((B C
int((C F
id((G I
)((I J
{)) 	
Console** 
.** 
	WriteLine** 
(** 
$str** <
+**= >
id**? A
)**A B
;**B C
var,, 
venue,, 
=,, 
await,, 

_venueRepo,, (
.,,( )
GetVenueById,,) 5
(,,5 6
id,,6 8
),,8 9
;,,9 :
if.. 
(.. 
venue.. 
!=.. 
null.. 
).. 
{// 
return00 
Ok00 
(00 
_mapper00 !
.00! "
Map00" %
<00% &
VenueReadDto00& 2
>002 3
(003 4
venue004 9
)009 :
)00: ;
;00; <
}11 
else22 
{33 
return44 
NotFound44 
(44  
)44  !
;44! "
}55 
}66 	
[88 	
HttpPut88	 
(88 
$str88 
)88 
]88 
[99 	
	Authorize99	 
(99 !
AuthenticationSchemes99 (
=99) *
JwtBearerDefaults99+ <
.99< = 
AuthenticationScheme99= Q
)99Q R
]99R S
public:: 
async:: 
Task:: 
<:: 
ActionResult:: &
<::& '
ClientUpdateDto::' 6
>::6 7
>::7 8
UpdateVenue::9 D
(::D E
int::E H
id::I K
,::K L
VenueUpdateDto::M [
venueUpdateDto::\ j
)::j k
{;; 	
string== 
venueId== 
=== 
this== !
.==! "
User==" &
.==& '
GetId==' ,
(==, -
)==- .
;==. /
var?? 
venue?? 
=?? 
await?? 

_venueRepo?? (
.??( )
GetVenueById??) 5
(??5 6
id??6 8
)??8 9
;??9 :
ifAA 
(AA 
venueIdAA 
!=AA 
venueAA  
.AA  !

ExternalIdAA! +
)AA+ ,
{BB 
returnCC 
UnauthorizedCC #
(CC# $
)CC$ %
;CC% &
}DD 
venueGG 
.GG 
NameGG 
=GG 
venueUpdateDtoGG '
.GG' (
NameGG( ,
;GG, -
venueHH 
.HH 
PhoneNumberHH 
=HH 
venueUpdateDtoHH  .
.HH. /
PhoneNumberHH/ :
;HH: ;
venueII 
.II 
AddressII 
=II 
venueUpdateDtoII *
.II* +
AddressII+ 2
;II2 3
venueJJ 
.JJ 
CityJJ 
=JJ 
venueUpdateDtoJJ '
.JJ' (
CityJJ( ,
;JJ, -

_venueRepoLL 
.LL 
UpdateVenueLL "
(LL" #
venueLL# (
)LL( )
;LL) *
ifMM 
(MM 
awaitMM 

_venueRepoMM  
.MM  !
SaveChangesMM! ,
(MM, -
)MM- .
)MM. /
{NN 
ConsoleOO 
.OO 
	WriteLineOO !
(OO! "
$strOO" F
)OOF G
;OOG H
varPP 
venueUpdatedPP  
=PP! "
_mapperPP# *
.PP* +
MapPP+ .
<PP. /
VenueUpdatedPP/ ;
>PP; <
(PP< =
venuePP= B
)PPB C
;PPC D
awaitRR 
_publishEndpointRR &
.RR& '
PublishRR' .
<RR. /
VenueUpdatedRR/ ;
>RR; <
(RR< =
venueUpdatedRR= I
)RRI J
;RRJ K
}SS 
returnUU 
	NoContentUU 
(UU 
)UU 
;UU 
}VV 	
[XX 	

HttpDeleteXX	 
(XX 
$strXX 
)XX 
]XX 
[YY 	
	AuthorizeYY	 
(YY !
AuthenticationSchemesYY (
=YY) *
JwtBearerDefaultsYY+ <
.YY< = 
AuthenticationSchemeYY= Q
)YYQ R
]YYR S
publicZZ 
asyncZZ 
TaskZZ 
<ZZ 
ActionResultZZ &
>ZZ& '
DeleteVenueZZ( 3
(ZZ3 4
intZZ4 7
idZZ8 :
)ZZ: ;
{[[ 	
string]] 
venueId]] 
=]] 
this]] !
.]]! "
User]]" &
.]]& '
GetId]]' ,
(]], -
)]]- .
;]]. /
var__ 
venue__ 
=__ 
await__ 

_venueRepo__ (
.__( )
GetVenueById__) 5
(__5 6
id__6 8
)__8 9
;__9 :
ifaa 
(aa 
venueaa 
isaa 
nullaa 
)aa 
{bb 
returncc 
NotFoundcc 
(cc  
$"cc  "
$strcc" :
"cc: ;
)cc; <
;cc< =
}dd 
ifff 
(ff 
venueIdff 
!=ff 
venueff  
.ff  !

ExternalIdff! +
)ff+ ,
{gg 
returnhh 
Unauthorizedhh #
(hh# $
)hh$ %
;hh% &
}ii 
varkk 
userDeletedkk 
=kk 
_mapperkk %
.kk% &
Mapkk& )
<kk) *
VenueDeletedkk* 6
>kk6 7
(kk7 8
venuekk8 =
)kk= >
;kk> ?

_venueRepomm 
.mm 
DeleteVenuemm "
(mm" #
venuemm# (
)mm( )
;mm) *
ifnn 
(nn 
awaitnn 

_venueReponn 
.nn  
SaveChangesnn  +
(nn+ ,
)nn, -
)nn- .
{nn/ 0
Consolepp 
.pp 
	WriteLinepp !
(pp! "
$strpp" F
)ppF G
;ppG H
awaitrr 
_publishEndpointrr &
.rr& '
Publishrr' .
<rr. /
VenueDeletedrr/ ;
>rr; <
(rr< =
userDeletedrr= H
)rrH I
;rrI J
}ss 
returnuu 
Okuu 
(uu 
)uu 
;uu 
}vv 	
}ww 
}xx ß
8E:\Work\Repos\EventEase\UserService\Data\AppDbContext.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

class 
AppDbContext 
: 
	DbContext  )
{ 
public 
AppDbContext 
( 
DbContextOptions ,
<, -
AppDbContext- 9
>9 :
opt; >
)> ?
:@ A
baseB F
(F G
optG J
)J K
{		 	
} 	
public 
DbSet 
< 
Client 
> 
Clients $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
DbSet 
< 
Venue 
> 
Venues "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} "
6E:\Work\Repos\EventEase\UserService\Data\ClientRepo.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

class 

ClientRepo 
: 
IClientRepo )
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public

 

ClientRepo

 
(

 
AppDbContext

 &
context

' .
)

. /
{ 	
_context 
= 
context 
; 
} 	
public 
void 
CreateClient  
(  !
Client! '
client( .
). /
{ 	
if 
( 
client 
is 
null 
) 
{ 
throw 
new !
ArgumentNullException /
(/ 0
nameof0 6
(6 7
client7 =
)= >
)> ?
;? @
} 
_context 
. 
Clients 
. 
AddAsync %
(% &
client& ,
), -
;- .
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Client& ,
>, -
>- .
GetAllClients/ <
(< =
int= @
pageSizeA I
,I J
intK N

pageNumberO Y
)Y Z
{ 	
if 
( 
pageSize 
> 
$num 
) 
{ 
pageSize 
= 
$num 
; 
} 
return 
await 
_context !
.! "
Clients" )
.   
Skip   
(   
(   

pageNumber   !
-  " #
$num  $ %
)  % &
*  ' (
pageSize  ) 1
)  1 2
.!! 
Take!! 
(!! 
pageSize!! 
)!! 
."" 
ToListAsync"" 
("" 
)"" 
;"" 
}## 	
public%% 
async%% 
Task%% 
<%% 
Client%%  
>%%  !
GetClientById%%" /
(%%/ 0
int%%0 3
id%%4 6
)%%6 7
{&& 	
return'' 
await'' 
_context'' !
.''! "
Clients''" )
.'') *
FirstOrDefaultAsync''* =
(''= >
c''> ?
=>''@ B
c''C D
.''D E
Id''E G
==''H J
id''K M
)''M N
;''N O
}(( 	
public** 
async** 
Task** 
<** 
Client**  
>**  !
GetClientByEmail**" 2
(**2 3
string**3 9
email**: ?
)**? @
{++ 	
return,, 
await,, 
_context,, !
.,,! "
Clients,," )
.,,) *
FirstOrDefaultAsync,,* =
(,,= >
c,,> ?
=>,,@ B
c,,C D
.,,D E
Email,,E J
==,,K M
email,,N S
),,S T
;,,T U
}-- 	
public// 
async// 
Task// 
<// 
bool// 
>// 
SaveChanges//  +
(//+ ,
)//, -
{00 	
return11 
(11 
await11 
_context11 "
.11" #
SaveChangesAsync11# 3
(113 4
)114 5
>=116 8
$num119 :
)11: ;
;11; <
}22 	
public44 
void44 
UpdateClient44  
(44  !
Client44! '
client44( .
)44. /
{55 	
_context66 
.66 
Clients66 
.66 
Update66 #
(66# $
client66$ *
)66* +
;66+ ,
}77 	
public99 
void99 
DeleteClient99  
(99  !
Client99! '
client99( .
)99. /
{:: 	
_context;; 
.;; 
Clients;; 
.;; 
Remove;; #
(;;# $
client;;$ *
);;* +
;;;+ ,
}<< 	
}== 
}>> 
7E:\Work\Repos\EventEase\UserService\Data\IClientRepo.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

	interface 
IClientRepo  
{ 
Task 
< 
bool 
> 
SaveChanges 
( 
)  
;  !
Task		 
<		 
IEnumerable		 
<		 
Client		 
>		  
>		  !
GetAllClients		" /
(		/ 0
int		0 3
pageSize		4 <
,		< =
int		> A

pageNumber		B L
)		L M
;		M N
Task 
< 
Client 
> 
GetClientById "
(" #
int# &
id' )
)) *
;* +
Task 
< 
Client 
> 
GetClientByEmail %
(% &
string& ,
email- 2
)2 3
;3 4
void 
CreateClient 
( 
Client  
client! '
)' (
;( )
void 
UpdateClient 
( 
Client  
client! '
)' (
;( )
void 
DeleteClient 
( 
Client  
client! '
)' (
;( )
} 
} Ï	
6E:\Work\Repos\EventEase\UserService\Data\IVenueRepo.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

	interface 

IVenueRepo 
{ 
Task 
< 
bool 
> 
SaveChanges 
( 
)  
;  !
Task		 
<		 
IEnumerable		 
<		 
Venue		 
>		 
>		  
GetAllVenues		! -
(		- .
int		. 1
pageSize		2 :
,		: ;
int		< ?

pageNumber		@ J
)		J K
;		K L
Task 
< 
Venue 
> 
GetVenueById  
(  !
int! $
id% '
)' (
;( )
void 
CreateVenue 
( 
Venue 
venue $
)$ %
;% &
void 
UpdateVenue 
( 
Venue 
venue $
)$ %
;% &
void 
DeleteVenue 
( 
Venue 
venue $
)$ %
;% &
} 
} ÿ
2E:\Work\Repos\EventEase\UserService\Data\PrepDb.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

static 
class 
PrepDb 
{ 
public 
static 
void 
PrepPopulation )
() *
IApplicationBuilder* =
app> A
,A B
boolC G
isProdH N
)N O
{ 	
using		 
(		 
var		 
serviceScope		 #
=		$ %
app		& )
.		) *
ApplicationServices		* =
.		= >
CreateScope		> I
(		I J
)		J K
)		K L
{

 
SeedData 
( 
serviceScope %
.% &
ServiceProvider& 5
.5 6

GetService6 @
<@ A
AppDbContextA M
>M N
(N O
)O P
,P Q
isProdR X
)X Y
;Y Z
} 
} 	
private 
static 
void 
SeedData $
($ %
AppDbContext% 1
context2 9
,9 :
bool; ?
isProd@ F
)F G
{ 	
if 
( 
! 
context 
. 
Clients 
.  
Any  #
(# $
)$ %
||& (
!) *
context* 1
.1 2
Venues2 8
.8 9
Any9 <
(< =
)= >
)> ?
{   
if"" 
("" 
!"" 
context"" 
."" 
Clients"" #
.""# $
Any""$ '
(""' (
)""( )
)"") *
{## 
Console$$ 
.$$ 
	WriteLine$$ %
($$% &
$str$$& D
)$$D E
;$$E F
context&& 
.&& 
Clients&& #
.&&# $
AddRange&&$ ,
(&&, -
new'' 
Client'' "
(''" #
)''# $
{''% &

ExternalId''& 0
=''0 1
$str''1 W
,''W X
Name''Y ]
=''] ^
$str''^ j
,''j k
Email''l q
=''q r
$str	''r 
}
'' 
)(( 
;(( 
})) 
if,, 
(,, 
!,, 
context,, 
.,, 
Venues,, "
.,," #
Any,,# &
(,,& '
),,' (
),,( )
{-- 
Console.. 
... 
	WriteLine.. %
(..% &
$str..& C
)..C D
;..D E
context00 
.00 
Venues00 "
.00" #
AddRange00# +
(00+ ,
new11 
Venue11 !
(11! "
)11" #
{11$ %

ExternalId11% /
=11/ 0
$str110 V
,11V W
Name11X \
=11\ ]
$str11] p
,11p q
Email11r w
=11w x
$str	11x 
,
11 
PhoneNumber
11 
=
11 
$str
11 «
,
11« ¬
Address
11­ ´
=
11´ µ
$str
11µ É
,
11É Ê
City
11Ë Ï
=
11Ï Ð
$str
11Ð Ü
}
11Ü Ý
)22 
;22 
}33 
context55 
.55 
SaveChanges55 #
(55# $
)55$ %
;55% &
}66 
else77 
{88 
Console99 
.99 
	WriteLine99 !
(99! "
$str99" 5
)995 6
;996 7
}:: 
};; 	
}<< 
}== Þ
5E:\Work\Repos\EventEase\UserService\Data\VenueRepo.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

class 
	VenueRepo 
: 

IVenueRepo '
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public

 
	VenueRepo

 
(

 
AppDbContext

 %
context

& -
)

- .
{ 	
_context 
= 
context 
; 
} 	
public 
void 
CreateVenue 
(  
Venue  %
venue& +
)+ ,
{ 	
if 
( 
venue 
is 
null 
) 
{ 
throw 
new !
ArgumentNullException /
(/ 0
nameof0 6
(6 7
venue7 <
)< =
)= >
;> ?
} 
_context 
. 
Venues 
. 
Add 
(  
venue  %
)% &
;& '
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Venue& +
>+ ,
>, -
GetAllVenues. :
(: ;
int; >
pageSize? G
,G H
intI L

pageNumberM W
)W X
{ 	
if 
( 
pageSize 
> 
$num 
) 
{ 
pageSize 
= 
$num 
; 
} 
return 
await 
_context !
.! "
Venues" (
.   
Skip   
(   
(   

pageNumber   !
-  " #
$num  $ %
)  % &
*  ' (
pageSize  ) 1
)  1 2
.!! 
Take!! 
(!! 
pageSize!! 
)!! 
."" 
ToListAsync"" 
("" 
)"" 
;"" 
}## 	
public%% 
async%% 
Task%% 
<%% 
Venue%% 
>%%  
GetVenueById%%! -
(%%- .
int%%. 1
id%%2 4
)%%4 5
{&& 	
return'' 
await'' 
_context'' !
.''! "
Venues''" (
.''( )
FirstOrDefaultAsync'') <
(''< =
v''= >
=>''? A
v''B C
.''C D
Id''D F
==''G I
id''J L
)''L M
;''M N
}(( 	
public** 
async** 
Task** 
<** 
bool** 
>** 
SaveChanges**  +
(**+ ,
)**, -
{++ 	
return,, 
(,, 
await,, 
_context,, "
.,," #
SaveChangesAsync,,# 3
(,,3 4
),,4 5
>=,,6 8
$num,,9 :
),,: ;
;,,; <
}-- 	
public// 
void// 
UpdateVenue// 
(//  
Venue//  %
venue//& +
)//+ ,
{00 	
_context11 
.11 
Venues11 
.11 
Update11 "
(11" #
venue11# (
)11( )
;11) *
}22 	
public44 
void44 
DeleteVenue44 
(44  
Venue44  %
venue44& +
)44+ ,
{55 	
_context66 
.66 
Venues66 
.66 
Remove66 "
(66" #
venue66# (
)66( )
;66) *
}77 	
}88 
}99 ´
KE:\Work\Repos\EventEase\UserService\Extensions\ClaimsPrincipleExtensions.cs
	namespace 	
UserService
 
. 

Extensions  
{ 
public 
static 
class %
ClaimsPrincipleExtensions .
{ 
public 
static	 
string 
GetId 
( 
this !
ClaimsPrincipal" 1
	principal2 ;
); <
{ 
var 
userIdClaim 
= 
	principal 
. 
	FindFirst (
(( )
c) *
=>+ -
c. /
./ 0
Type0 4
==5 7
$str8 <
)< =
;= >
if 
( 
userIdClaim 
!= 
null 
&& 
! 
string %
.% &
IsNullOrEmpty& 3
(3 4
userIdClaim4 ?
.? @
Value@ E
)E F
)F G
{ 
return 

userIdClaim 
. 
Value 
; 
} 
return 	
null
 
; 
} 
public 
static	 
string 
GetRoles 
(  
this  $
ClaimsPrincipal% 4
	principal5 >
)> ?
{ 
var 
userRoleClaim 
= 
	principal  
.  !
	FindFirst! *
(* +
c+ ,
=>- /
c0 1
.1 2
Type2 6
==7 9

ClaimTypes: D
.D E
RoleE I
)I J
??K M
	principalN W
.W X
	FindFirstX a
(a b
cb c
=>d f
cg h
.h i
Typei m
==n p
$strq w
)w x
;x y
if 
( 
userRoleClaim 
!= 
null 
&& 
!  !
string! '
.' (
IsNullOrEmpty( 5
(5 6
userRoleClaim6 C
.C D
ValueD I
)I J
)J K
{   
return!! 

userRoleClaim!! 
.!! 
Value!! 
;!! 
}"" 
return$$ 	
null$$
 
;$$ 
}%% 
}&& 
}'' 
4E:\Work\Repos\EventEase\UserService\Models\Client.cs
	namespace 	
UserService
 
. 
Models 
{ 
public 

class 
Client 
: 
UserBase "
{ 
} 
} ò
@E:\Work\Repos\EventEase\UserService\Models\Dtos\ClientReadDto.cs
	namespace 	
UserService
 
. 
Models 
. 
Dtos !
{ 
public 

class 
ClientReadDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public		 
string		 
Email		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
}

 
} Ó
BE:\Work\Repos\EventEase\UserService\Models\Dtos\ClientUpdateDto.cs
	namespace 	
UserService
 
. 
Models 
. 
Dtos !
{ 
public 

class 
ClientUpdateDto  
{ 
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
[		 	
RegularExpression			 
(		 
$str		 *
)		* +
]		+ ,
public

 
string

 
Name

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
} 
} Â	
?E:\Work\Repos\EventEase\UserService\Models\Dtos\VenueReadDto.cs
	namespace 	
UserService
 
. 
Models 
. 
Dtos !
{ 
public 

class 
VenueReadDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
PhoneNumber !
{" #
get$ '
;' (
set) ,
;, -
}. /
public		 
string		 
Address		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public

 
string

 
City

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
} 
} ì
AE:\Work\Repos\EventEase\UserService\Models\Dtos\VenueUpdateDto.cs
	namespace 	
UserService
 
. 
Models 
. 
Dtos !
{ 
public 

class 
VenueUpdateDto 
{ 
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
, 
ErrorMessage &
=' (
$str) M
)M N
]N O
[		 	
RegularExpression			 
(		 
$str		 -
,		- .
ErrorMessage		/ ;
=		< =
$str		> Q
)		Q R
]		R S
public

 
string

 
Name

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
[ 	
StringLength	 
( 
$num 
, 
ErrorMessage &
=' (
$str) U
)U V
]V W
[ 	
Phone	 
] 
public 
string 
PhoneNumber !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
StringLength	 
( 
$num 
, 
ErrorMessage &
=' (
$str) P
)P Q
]Q R
[ 	
RegularExpression	 
( 
$str 1
,1 2
ErrorMessage3 ?
=@ A
$strB X
)X Y
]Y Z
public 
string 
Address 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
StringLength	 
( 
$num 
, 
ErrorMessage &
=' (
$str) M
)M N
]N O
[ 	
RegularExpression	 
( 
$str *
,* +
ErrorMessage, 8
=9 :
$str; N
)N O
]O P
public 
string 
City 
{ 
get  
;  !
set" %
;% &
}' (
} 
} 	
6E:\Work\Repos\EventEase\UserService\Models\UserBase.cs
	namespace 	
UserService
 
. 
Models 
{ 
public 

class 
UserBase 
{ 
[ 	
Key	 
] 
[ 	
Required	 
] 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
[ 	
Required	 
] 
public 
string 

ExternalId  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 	
Required	 
] 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Required	 
] 
[ 	
EmailAddress	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
} 
} ï
3E:\Work\Repos\EventEase\UserService\Models\Venue.cs
	namespace 	
UserService
 
. 
Models 
{ 
public 

class 
Venue 
: 
UserBase !
{ 
public 
string 
PhoneNumber !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
Address 
{ 
get  #
;# $
set% (
;( )
}* +
public		 
string		 
City		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
}

 
} ô"
<E:\Work\Repos\EventEase\UserService\Profiles\UsersProfile.cs
	namespace 	
UserService
 
. 
Profiles 
{ 
public 

class 
UsersProfile 
: 
Profile  '
{		 
public

 
UsersProfile

 
(

 
)

 
{ 	
	CreateMap 
< 
Client 
, 
ClientReadDto +
>+ ,
(, -
)- .
;. /
	CreateMap 
< 
Venue 
, 
VenueReadDto )
>) *
(* +
)+ ,
;, -
	CreateMap 
< 
VenueCreated "
," #
Venue$ )
>) *
(* +
)+ ,
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (

ExternalId( 2
,2 3
opt4 7
=>8 :
opt 
. 
MapFrom 
(  
src  #
=>$ &
src' *
.* +
Id+ -
)- .
) 
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Id( *
,* +
opt 
=> 
opt 
. 
Ignore %
(% &
)& '
) 
; 
	CreateMap 
< 
ClientCreated #
,# $
Client% +
>+ ,
(, -
)- .
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (

ExternalId( 2
,2 3
opt4 7
=>8 :
opt 
. 
MapFrom 
(  
src  #
=>$ &
src' *
.* +
Id+ -
)- .
) 
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Id( *
,* +
opt 
=> 
opt 
. 
Ignore %
(% &
)& '
) 
; 
	CreateMap!! 
<!! 
Venue!! 
,!! 
VenueDeleted!! )
>!!) *
(!!* +
)!!+ ,
."" 
	ForMember"" 
("" 
dest"" 
=>""  "
dest""# '
.""' (
Id""( *
,""* +
opt"", /
=>""0 2
opt## 
.## 
MapFrom## 
(##  
src##  #
=>##$ &
src##' *
.##* +

ExternalId##+ 5
)##5 6
)$$ 
;$$ 
	CreateMap&& 
<&& 
Client&& 
,&& 
ClientDeleted&& +
>&&+ ,
(&&, -
)&&- .
.'' 
	ForMember'' 
('' 
dest'' 
=>''  "
dest''# '
.''' (
Id''( *
,''* +
opt'', /
=>''0 2
opt(( 
.(( 
MapFrom(( 
(((  
src((  #
=>(($ &
src((' *
.((* +

ExternalId((+ 5
)((5 6
))) 
;)) 
	CreateMap++ 
<++ 
Venue++ 
,++ 
VenueUpdated++ )
>++) *
(++* +
)+++ ,
.,, 
	ForMember,, 
(,, 
dest,, 
=>,,  "
dest,,# '
.,,' (
Id,,( *
,,,* +
opt,,, /
=>,,0 2
opt-- 
.-- 
MapFrom-- 
(--  
src--  #
=>--$ &
src--' *
.--* +

ExternalId--+ 5
)--5 6
).. 
;.. 
	CreateMap00 
<00 
Client00 
,00 
ClientUpdated00 +
>00+ ,
(00, -
)00- .
.11 
	ForMember11 
(11 
dest11 
=>11  "
dest11# '
.11' (
Id11( *
,11* +
opt11, /
=>110 2
opt22 
.22 
MapFrom22 
(22  
src22  #
=>22$ &
src22' *
.22* +

ExternalId22+ 5
)225 6
)33 
;33 
}44 	
}66 
}77 òV
.E:\Work\Repos\EventEase\UserService\Program.cs
public		 
class		 
Program		 
{

 
static 

void 
Main 
( 
string 
[ 
] 
args "
)" #
{ 
var 
builder 
= 
WebApplication $
.$ %
CreateBuilder% 2
(2 3
args3 7
)7 8
;8 9
var 
rabbitMQ 
= 
$str 
; 
var 
	jwtConfig 
= 
$str 
; 
var 
connectionString 
= 
$str !
;! "
if 

( 
builder 
. 
Environment 
.  
IsProduction  ,
(, -
)- .
). /
{ 	
rabbitMQ 
= 
Environment "
." #"
GetEnvironmentVariable# 9
(9 :
$str: E
)E F
;F G
Console 
. 
	WriteLine 
( 
rabbitMQ &
)& '
;' (
	jwtConfig 
= 
Environment #
.# $"
GetEnvironmentVariable$ :
(: ;
$str; @
)@ A
;A B
Console 
. 
	WriteLine 
( 
	jwtConfig '
)' (
;( )
connectionString 
= 
Environment *
.* +"
GetEnvironmentVariable+ A
(A B
$strB ]
)] ^
;^ _
Console 
. 
	WriteLine 
( 
connectionString .
). /
;/ 0
Console 
. 
	WriteLine 
( 
$str 8
)8 9
;9 :
builder 
. 
Services 
. 
AddDbContext )
<) *
AppDbContext* 6
>6 7
(7 8
options8 ?
=>@ B
options   
.   
UseSqlServer   $
(  $ %
connectionString  % 5
)  5 6
)!! 
;!! 
}"" 	
else## 
{$$ 	
rabbitMQ%% 
=%% 
$"%% 
$str%% ,
{%%, -
builder%%- 4
.%%4 5
Configuration%%5 B
[%%B C
$str%%C Q
]%%Q R
}%%R S
$str%%S T
{%%T U
builder%%U \
.%%\ ]
Configuration%%] j
[%%j k
$str%%k y
]%%y z
}%%z {
"%%{ |
;%%| }
	jwtConfig&& 
=&& 
builder&& 
.&&  
Configuration&&  -
.&&- .

GetSection&&. 8
(&&8 9
$str&&9 K
)&&K L
.&&L M
Value&&M R
;&&R S
Console(( 
.(( 
	WriteLine(( 
((( 
$str(( 4
)((4 5
;((5 6
builder)) 
.)) 
Services)) 
.)) 
AddDbContext)) )
<))) *
AppDbContext))* 6
>))6 7
())7 8
opt))8 ;
=>))< >
opt** 
.** 
UseInMemoryDatabase** '
(**' (
$str**( /
)**/ 0
)++ 
;++ 
},, 	
builder.. 
... 
Services.. 
... 
AddAutoMapper.. &
(..& '
	AppDomain..' 0
...0 1
CurrentDomain..1 >
...> ?
GetAssemblies..? L
(..L M
)..M N
)..N O
;..O P
builder11 
.11 
Services11 
.11 
AddMassTransit11 '
(11' (
config11( .
=>11/ 1
{22 	
config44 
.44 
AddConsumer44 
<44 !
ClientCreatedConsumer44 4
>444 5
(445 6
)446 7
;447 8
config55 
.55 
AddConsumer55 
<55  
VenueCreatedConsumer55 3
>553 4
(554 5
)555 6
;556 7
config77 
.77 -
!SetKebabCaseEndpointNameFormatter77 4
(774 5
)775 6
;776 7
config99 
.99 
UsingRabbitMq99  
(99  !
(99! "
ctx99" %
,99% &
cfg99' *
)99* +
=>99, .
{:: 
Console;; 
.;; 
	WriteLine;; !
(;;! "
rabbitMQ;;" *
);;* +
;;;+ ,
cfg<< 
.<< 
Host<< 
(<< 
rabbitMQ<< !
)<<! "
;<<" #
cfg>> 
.>> 
ReceiveEndpoint>> #
(>># $
$str>>$ I
,>>I J
c>>K L
=>>>M O
{?? 
cAA 
.AA 
ConfigureConsumerAA '
<AA' (!
ClientCreatedConsumerAA( =
>AA= >
(AA> ?
ctxAA? B
)AAB C
;AAC D
}BB 
)BB 
;BB 
cfgDD 
.DD 
ReceiveEndpointDD #
(DD# $
$strDD$ H
,DDH I
cDDJ K
=>DDL N
{EE 
cGG 
.GG 
ConfigureConsumerGG '
<GG' ( 
VenueCreatedConsumerGG( <
>GG< =
(GG= >
ctxGG> A
)GGA B
;GGB C
}HH 
)HH 
;HH 
}II 
)II 
;II 
}JJ 	
)JJ	 

;JJ
 
builderMM 
.MM 
ServicesMM 
.MM 
	AddScopedMM "
<MM" #
IClientRepoMM# .
,MM. /

ClientRepoMM0 :
>MM: ;
(MM; <
)MM< =
;MM= >
builderNN 
.NN 
ServicesNN 
.NN 
	AddScopedNN "
<NN" #

IVenueRepoNN# -
,NN- .
	VenueRepoNN/ 8
>NN8 9
(NN9 :
)NN: ;
;NN; <
varQQ "
allowedSpecificOriginsQQ "
=QQ# $
$strQQ% >
;QQ> ?
builderSS 
.SS 
ServicesSS 
.SS 
AddCorsSS  
(SS  !
optionsSS! (
=>SS) +
{TT 	
optionsUU 
.UU 
	AddPolicyUU 
(UU 
nameUU "
:UU" #"
allowedSpecificOriginsUU$ :
,UU: ;
policyVV 
=>VV 
{WW 
policyXX 
.XX 
WithOriginsXX &
(XX& '
$strXX' <
,XX< =
$strYY( ?
)YY? @
;YY@ A
}ZZ 
)[[ 
;[[ 
}\\ 	
)\\	 

;\\
 
builder__ 
.__ 
Services__ 
.__ 
AddControllers__ '
(__' (
)__( )
;__) *
builderaa 
.aa 
Servicesaa 
.aa #
AddEndpointsApiExploreraa 0
(aa0 1
)aa1 2
;aa2 3
builderbb 
.bb 
Servicesbb 
.bb 
AddSwaggerGenbb &
(bb& '
)bb' (
;bb( )
builderee 
.ee 
Servicesee 
.ee 
AddAuthenticationee *
(ee* +
optionsee+ 2
=>ee3 5
{ff 
optionsgg 
.gg %
DefaultAuthenticateSchemegg 1
=gg2 3
JwtBearerDefaultsgg4 E
.ggE F 
AuthenticationSchemeggF Z
;ggZ [
optionshh 
.hh 
DefaultSchemehh %
=hh& '
JwtBearerDefaultshh( 9
.hh9 : 
AuthenticationSchemehh: N
;hhN O
optionsii 
.ii "
DefaultChallengeSchemeii .
=ii/ 0
JwtBearerDefaultsii1 B
.iiB C 
AuthenticationSchemeiiC W
;iiW X
}jj 
)jj 
.kk 
AddJwtBearerkk 
(kk 
jwtkk 
=>kk  
{ll 
varmm 
keymm 
=mm 
Encodingmm "
.mm" #
ASCIImm# (
.mm( )
GetBytesmm) 1
(mm1 2
	jwtConfigmm2 ;
)mm; <
;mm< =
jwtnn 
.nn 
	SaveTokennn 
=nn 
truenn  $
;nn$ %
jwtpp 
.pp %
TokenValidationParameterspp -
=pp. /
newpp0 3%
TokenValidationParameterspp4 M
(ppM N
)ppN O
{qq $
ValidateIssuerSigningKeyrr ,
=rr- .
truerr/ 3
,rr3 4
IssuerSigningKeyss $
=ss% &
newss' * 
SymmetricSecurityKeyss+ ?
(ss? @
keyss@ C
)ssC D
,ssD E
ValidateIssuertt "
=tt# $
falsett% *
,tt* +
ValidateAudienceuu $
=uu% &
falseuu' ,
,uu, -!
RequireExpirationTimeww )
=ww* +
trueww, 0
,ww0 1
ValidateLifetimexx $
=xx% &
truexx' +
,xx+ ,
	ClockSkewyy 
=yy 
TimeSpanyy  (
.yy( )
Zeroyy) -
}zz 
;zz 
}{{ 
){{ 
;{{ 
builder}} 
.}} 
Services}} 
.}} 
AddAuthorization}} )
(}}) *
)}}* +
;}}+ ,
var 
app 
= 
builder 
. 
Build 
(  
)  !
;! "
if
 

(
 
app
 
.
 
Environment
 
.
 
IsDevelopment
 )
(
) *
)
* +
)
+ ,
{
 	
app
 
.
 

UseSwagger
 
(
 
)
 
;
 
app
 
.
 
UseSwaggerUI
 
(
 
)
 
;
 
}
 	
PrepDb
 
.
 
PrepPopulation
 
(
 
app
 !
,
! "
app
# &
.
& '
Environment
' 2
.
2 3
IsProduction
3 ?
(
? @
)
@ A
)
A B
;
B C
app
 
.
 !
UseHttpsRedirection
 
(
  
)
  !
;
! "
app
 
.
 
UseCors
 
(
 $
allowedSpecificOrigins
 *
)
* +
;
+ ,
app
 
.
 
UseAuthorization
 
(
 
)
 
;
 
app
 
.
 
MapControllers
 
(
 
)
 
;
 
app
 
.
 
Run
 
(
 
)
 
;
 
}
 
} 
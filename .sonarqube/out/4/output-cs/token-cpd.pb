Ï
DE:\Work\Repos\EventEase\UserService\Consumers\UserCreatedConsumer.cs
	namespace 	
UserService
 
. 
	Consumers 
{ 
public		 

class		 
UserCreatedConsumer		 $
:		$ %
	IConsumer		& /
<		/ 0
UserCreated		0 ;
>		; <
{

 
private 
readonly 
ILogger  
<  !
UserCreated! ,
>, -
_logger. 5
;5 6
private 
readonly 
AppDbContext %
_context& .
;. /
private 
readonly 
IMapper  
_mapper! (
;( )
public 
UserCreatedConsumer "
(" #
ILogger# *
<* +
UserCreated+ 6
>6 7
logger8 >
,> ?
AppDbContext@ L
contextM T
,T U
IMapperV ]
mapper^ d
)d e
{ 	
_logger 
= 
logger 
; 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
} 	
public 
async 
Task 
Consume !
(! "
ConsumeContext" 0
<0 1
UserCreated1 <
>< =
context> E
)E F
{ 	
var 
userCreated 
= 
context %
.% &
Message& -
;- .
_logger 
. 
LogInformation "
(" #
$"# %
$str% ;
{; <
userCreated< G
.G H
NameH L
}L M
"M N
)N O
;O P
if 
( 
userCreated 
. 
Role 
==  "
$str# *
)* +
{, -
var 

venueModel 
=  
_mapper! (
.( )
Map) ,
<, -
Venue- 2
>2 3
(3 4
userCreated4 ?
)? @
;@ A
await   
_context   
.   
Venues   %
.  % &
AddAsync  & .
(  . /

venueModel  / 9
)  9 :
;  : ;
}!! 
else!! 
if!! 
(!! 
userCreated!! !
.!!! "
Role!!" &
==!!' )
$str!!* 2
)!!2 3
{!!4 5
var"" 
clientModel"" 
=""  !
_mapper""" )
."") *
Map""* -
<""- .
Client"". 4
>""4 5
(""5 6
userCreated""6 A
)""A B
;""B C
await$$ 
_context$$ 
.$$ 
Clients$$ &
.$$& '
AddAsync$$' /
($$/ 0
clientModel$$0 ;
)$$; <
;$$< =
}%% 
_context'' 
.'' 
SaveChanges''  
(''  !
)''! "
;''" #
}(( 	
})) 
}** ÏP
DE:\Work\Repos\EventEase\UserService\Controllers\ClientsController.cs
	namespace 	
UserService
 
. 
Controllers !
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
ClientsController "
:# $
ControllerBase% 3
{ 
private 
readonly 
IClientRepo $
_clientRepo% 0
;0 1
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
IPublishEndpoint )
_publishEndpoint* :
;: ;
public 
ClientsController  
(  !
IClientRepo! ,

clientRepo- 7
,7 8
IMapper9 @
mapperA G
,G H
IPublishEndpoint 
publishEndpoint ,
), -
{ 	
_clientRepo 
= 

clientRepo $
;$ %
_mapper 
= 
mapper 
; 
_publishEndpoint 
= 
publishEndpoint .
;. /
} 	
[ 	
HttpGet	 
] 
[   	
	Authorize  	 
(   !
AuthenticationSchemes   (
=  ) *
JwtBearerDefaults  + <
.  < = 
AuthenticationScheme  = Q
,  Q R
Roles  S X
=  Y Z
$str  [ b
)  b c
]  c d
public!! 
ActionResult!! 
<!! 
IEnumerable!! '
<!!' (
ClientReadDto!!( 5
>!!5 6
>!!6 7

GetClients!!8 B
(!!B C
)!!C D
{"" 	
Console## 
.## 
	WriteLine## 
(## 
$str## 8
)##8 9
;##9 :
var%% 
clients%% 
=%% 
_clientRepo%% %
.%%% &
GetAllClients%%& 3
(%%3 4
)%%4 5
;%%5 6
return'' 
Ok'' 
('' 
_mapper'' 
.'' 
Map'' !
<''! "
IEnumerable''" -
<''- .
ClientReadDto''. ;
>''; <
>''< =
(''= >
clients''> E
)''E F
)''F G
;''G H
}(( 	
[** 	
HttpGet**	 
(** 
$str** 
,** 
Name** 
=** 
$str**  /
)**/ 0
]**0 1
[++ 	
	Authorize++	 
(++ !
AuthenticationSchemes++ (
=++) *
JwtBearerDefaults+++ <
.++< = 
AuthenticationScheme++= Q
)++Q R
]++R S
public,, 
ActionResult,, 
<,, 
ClientReadDto,, )
>,,) *
GetClientById,,+ 8
(,,8 9
int,,9 <
id,,= ?
),,? @
{-- 	
Console.. 
... 
	WriteLine.. 
(.. 
$str.. =
+..> ?
id..@ B
)..B C
;..C D
string11 
clientId11 
=11 
this11 "
.11" #
User11# '
.11' (
GetId11( -
(11- .
)11. /
;11/ 0
var33 
client33 
=33 
_clientRepo33 $
.33$ %
GetClientById33% 2
(332 3
id333 5
)335 6
;336 7
if55 
(55 
clientId55 
!=55 
client55 "
.55" #

ExternalId55# -
)55- .
{66 
return77 
Unauthorized77 #
(77# $
)77$ %
;77% &
}88 
if:: 
(:: 
client:: 
!=:: 
null:: 
):: 
{;; 
return<< 
Ok<< 
(<< 
_mapper<< !
.<<! "
Map<<" %
<<<% &
ClientReadDto<<& 3
><<3 4
(<<4 5
client<<5 ;
)<<; <
)<<< =
;<<= >
}== 
else>> 
{?? 
return@@ 
NotFound@@ 
(@@  
)@@  !
;@@! "
}AA 
}BB 	
[DD 	
HttpGetDD	 
(DD 
$strDD #
,DD# $
NameDD% )
=DD* +
$strDD, >
)DD> ?
]DD? @
publicEE 
ActionResultEE 
<EE 
ClientReadDtoEE )
>EE) *
GetClientByEmailEE+ ;
(EE; <
stringEE< B
emailEEC H
)EEH I
{FF 	
ConsoleGG 
.GG 
	WriteLineGG 
(GG 
$strGG @
+GGA B
emailGGC H
)GGH I
;GGI J
stringJJ 
clientIdJJ 
=JJ 
thisJJ "
.JJ" #
UserJJ# '
.JJ' (
GetIdJJ( -
(JJ- .
)JJ. /
;JJ/ 0
varLL 
clientLL 
=LL 
_clientRepoLL $
.LL$ %
GetClientByEmailLL% 5
(LL5 6
emailLL6 ;
)LL; <
;LL< =
ifNN 
(NN 
clientIdNN 
!=NN 
clientNN "
.NN" #

ExternalIdNN# -
)NN- .
{OO 
returnPP 
UnauthorizedPP #
(PP# $
)PP$ %
;PP% &
}QQ 
ifSS 
(SS 
clientSS 
!=SS 
nullSS 
)SS 
{TT 
returnUU 
OkUU 
(UU 
_mapperUU !
.UU! "
MapUU" %
<UU% &
ClientReadDtoUU& 3
>UU3 4
(UU4 5
clientUU5 ;
)UU; <
)UU< =
;UU= >
}VV 
elseWW 
{XX 
returnYY 
NotFoundYY 
(YY  
)YY  !
;YY! "
}ZZ 
}[[ 	
[]] 
HttpPut]] 
(]] 
$str]] 
)]] 
]]] 
[^^ 
	Authorize^^ 
(^^ !
AuthenticationSchemes^^ '
=^^( )
JwtBearerDefaults^^* ;
.^^; < 
AuthenticationScheme^^< P
)^^P Q
]^^Q R
public__ 
ActionResult__ 
<__ 
ClientUpdateDto__ *
>__* +
UpdateClient__, 8
(__8 9
int__9 <
id__= ?
,__? @
ClientUpdateDto__A P
clientUpdateDto__Q `
)__` a
{`` 
stringbb 
clientIdbb 
=bb 
thisbb "
.bb" #
Userbb# '
.bb' (
GetIdbb( -
(bb- .
)bb. /
;bb/ 0
vardd 
clientdd 
=dd 
_clientRepodd $
.dd$ %
GetClientByIddd% 2
(dd2 3
iddd3 5
)dd5 6
;dd6 7
ifff 
(ff 
clientff 
isff 
nullff 
)ff 
{gg 
returnhh 
NotFoundhh 
(hh  
$"hh  "
$strhh" ;
"hh; <
)hh< =
;hh= >
}ii 
ifkk 
(kk 
clientIdkk 
!=kk 
clientkk "
.kk" #

ExternalIdkk# -
)kk- .
{ll 
returnmm 
Unauthorizedmm #
(mm# $
)mm$ %
;mm% &
}nn 
clientqq 
.qq 
Nameqq 
=qq 
clientUpdateDtoqq )
.qq) *
Nameqq* .
;qq. /
_clientReposs 
.ss 
UpdateClientss $
(ss$ %
clientss% +
)ss+ ,
;ss, -
_clientRepott 
.tt 
SaveChangestt #
(tt# $
)tt$ %
;tt% &
returnvv 
	NoContentvv 
(vv 
)vv 
;vv 
}ww 
[yy 

HttpDeleteyy 
(yy 
$stryy 
)yy 
]yy 
[zz 
	Authorizezz 
(zz !
AuthenticationSchemeszz '
=zz( )
JwtBearerDefaultszz* ;
.zz; < 
AuthenticationSchemezz< P
)zzP Q
]zzQ R
public{{ 
ActionResult{{ 
DeleteClient{{ '
({{' (
int{{( +
id{{, .
){{. /
{|| 
string~~ 
clientId~~ 
=~~ 
this~~ "
.~~" #
User~~# '
.~~' (
GetId~~( -
(~~- .
)~~. /
;~~/ 0
var
ÄÄ 
client
ÄÄ 
=
ÄÄ 
_clientRepo
ÄÄ $
.
ÄÄ$ %
GetClientById
ÄÄ% 2
(
ÄÄ2 3
id
ÄÄ3 5
)
ÄÄ5 6
;
ÄÄ6 7
if
ÇÇ 
(
ÇÇ 
client
ÇÇ 
is
ÇÇ 
null
ÇÇ 
)
ÇÇ 
{
ÉÉ 
return
ÑÑ 
NotFound
ÑÑ 
(
ÑÑ  
$"
ÑÑ  "
$str
ÑÑ" ;
"
ÑÑ; <
)
ÑÑ< =
;
ÑÑ= >
}
ÖÖ 
if
áá 
(
áá 
clientId
áá 
!=
áá 
client
áá "
.
áá" #

ExternalId
áá# -
)
áá- .
{
àà 
return
ââ 
Unauthorized
ââ #
(
ââ# $
)
ââ$ %
;
ââ% &
}
ää 
var
èè 
userDeleted
èè 
=
èè 
_mapper
èè %
.
èè% &
Map
èè& )
<
èè) *
UserDeleted
èè* 5
>
èè5 6
(
èè6 7
client
èè7 =
)
èè= >
;
èè> ?
_clientRepo
ëë 
.
ëë 
DeleteClient
ëë $
(
ëë$ %
client
ëë% +
)
ëë+ ,
;
ëë, -
_clientRepo
íí 
.
íí 
SaveChanges
íí #
(
íí# $
)
íí$ %
;
íí% &
_publishEndpoint
ïï 
.
ïï 
Publish
ïï $
<
ïï$ %
UserDeleted
ïï% 0
>
ïï0 1
(
ïï1 2
userDeleted
ïï2 =
)
ïï= >
;
ïï> ?
return
óó 
Ok
óó 
(
óó 
)
óó 
;
óó 
}
òò 
}
ôô 
}öö ˆ;
CE:\Work\Repos\EventEase\UserService\Controllers\VenuesController.cs
	namespace 	
UserService
 
. 
Controllers !
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
VenuesController !
:" #
ControllerBase$ 2
{ 
private 
readonly 

IVenueRepo #

_venueRepo$ .
;. /
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
IPublishEndpoint )
_publishEndpoint* :
;: ;
public 
VenuesController 
(  

IVenueRepo  *
	venueRepo+ 4
,4 5
IMapper6 =
mapper> D
,D E
IPublishEndpointF V
publishEndpointW f
)f g
{ 	

_venueRepo 
= 
	venueRepo "
;" #
_mapper 
= 
mapper 
; 
_publishEndpoint 
= 
publishEndpoint .
;. /
} 	
[ 	
HttpGet	 
] 
public 
ActionResult 
< 
IEnumerable '
<' (
VenueReadDto( 4
>4 5
>5 6
	GetVenues7 @
(@ A
)A B
{ 	
Console 
. 
	WriteLine 
( 
$str 7
)7 8
;8 9
var!! 
venues!! 
=!! 

_venueRepo!! #
.!!# $
GetAllVenues!!$ 0
(!!0 1
)!!1 2
;!!2 3
return## 
Ok## 
(## 
_mapper## 
.## 
Map## !
<##! "
IEnumerable##" -
<##- .
VenueReadDto##. :
>##: ;
>##; <
(##< =
venues##= C
)##C D
)##D E
;##E F
}$$ 	
[&& 	
HttpGet&&	 
(&& 
$str&& 
,&& 
Name&& 
=&& 
$str&&  .
)&&. /
]&&/ 0
public'' 
ActionResult'' 
<'' 
VenueReadDto'' (
>''( )
GetVenueById''* 6
(''6 7
int''7 :
id''; =
)''= >
{(( 	
Console)) 
.)) 
	WriteLine)) 
()) 
$str)) <
+))= >
id))? A
)))A B
;))B C
var++ 
venue++ 
=++ 

_venueRepo++ "
.++" #
GetVenueById++# /
(++/ 0
id++0 2
)++2 3
;++3 4
if-- 
(-- 
venue-- 
!=-- 
null-- 
)-- 
{.. 
return// 
Ok// 
(// 
_mapper// !
.//! "
Map//" %
<//% &
VenueReadDto//& 2
>//2 3
(//3 4
venue//4 9
)//9 :
)//: ;
;//; <
}00 
else11 
{22 
return33 
NotFound33 
(33  
)33  !
;33! "
}44 
}55 	
[77 	
HttpPut77	 
(77 
$str77 
)77 
]77 
[88 	
	Authorize88	 
(88 !
AuthenticationSchemes88 (
=88) *
JwtBearerDefaults88+ <
.88< = 
AuthenticationScheme88= Q
)88Q R
]88R S
public99 
ActionResult99 
<99 
ClientUpdateDto99 +
>99+ ,
UpdateClient99- 9
(999 :
int99: =
id99> @
,99@ A
VenueUpdateDto99B P
venueUpdateDto99Q _
)99_ `
{:: 	
string<< 
venueId<< 
=<< 
this<< !
.<<! "
User<<" &
.<<& '
GetId<<' ,
(<<, -
)<<- .
;<<. /
var>> 
venue>> 
=>> 

_venueRepo>> "
.>>" #
GetVenueById>># /
(>>/ 0
id>>0 2
)>>2 3
;>>3 4
if@@ 
(@@ 
venueId@@ 
!=@@ 
venue@@  
.@@  !

ExternalId@@! +
)@@+ ,
{AA 
returnBB 
UnauthorizedBB #
(BB# $
)BB$ %
;BB% &
}CC 
venueFF 
.FF 
NameFF 
=FF 
venueUpdateDtoFF '
.FF' (
NameFF( ,
;FF, -
venueGG 
.GG 
PhoneNumberGG 
=GG 
venueUpdateDtoGG  .
.GG. /
PhoneNumberGG/ :
;GG: ;
venueHH 
.HH 
AddressHH 
=HH 
venueUpdateDtoHH *
.HH* +
AddressHH+ 2
;HH2 3
venueII 
.II 
CityII 
=II 
venueUpdateDtoII '
.II' (
CityII( ,
;II, -

_venueRepoLL 
.LL 
UpdateVenueLL "
(LL" #
venueLL# (
)LL( )
;LL) *

_venueRepoMM 
.MM 
SaveChangesMM "
(MM" #
)MM# $
;MM$ %
returnOO 
	NoContentOO 
(OO 
)OO 
;OO 
}PP 	
[RR 	

HttpDeleteRR	 
(RR 
$strRR 
)RR 
]RR 
[SS 	
	AuthorizeSS	 
(SS !
AuthenticationSchemesSS (
=SS) *
JwtBearerDefaultsSS+ <
.SS< = 
AuthenticationSchemeSS= Q
)SSQ R
]SSR S
publicTT 
ActionResultTT 
DeleteVenueTT '
(TT' (
intTT( +
idTT, .
)TT. /
{UU 	
stringWW 
venueIdWW 
=WW 
thisWW !
.WW! "
UserWW" &
.WW& '
GetIdWW' ,
(WW, -
)WW- .
;WW. /
varYY 
venueYY 
=YY 

_venueRepoYY "
.YY" #
GetVenueByIdYY# /
(YY/ 0
idYY0 2
)YY2 3
;YY3 4
if[[ 
([[ 
venue[[ 
is[[ 
null[[ 
)[[ 
{\\ 
return]] 
NotFound]] 
(]]  
$"]]  "
$str]]" :
"]]: ;
)]]; <
;]]< =
}^^ 
if`` 
(`` 
venueId`` 
!=`` 
venue``  
.``  !

ExternalId``! +
)``+ ,
{aa 
returnbb 
Unauthorizedbb #
(bb# $
)bb$ %
;bb% &
}cc 
varee 
userDeletedee 
=ee 
_mapperee %
.ee% &
Mapee& )
<ee) *
UserDeletedee* 5
>ee5 6
(ee6 7
venueee7 <
)ee< =
;ee= >

_venueRepogg 
.gg 
DeleteVenuegg "
(gg" #
venuegg# (
)gg( )
;gg) *

_venueRepohh 
.hh 
SaveChangeshh "
(hh" #
)hh# $
;hh$ %
_publishEndpointkk 
.kk 
Publishkk $
<kk$ %
UserDeletedkk% 0
>kk0 1
(kk1 2
userDeletedkk2 =
)kk= >
;kk> ?
returnmm 
Okmm 
(mm 
)mm 
;mm 
}nn 	
}oo 
}pp ﬂ
8E:\Work\Repos\EventEase\UserService\Data\AppDbContext.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

class 
AppDbContext 
: 
	DbContext  )
{ 
public 
AppDbContext 
( 
DbContextOptions ,
<, -
AppDbContext- 9
>9 :
opt; >
)> ?
:@ A
baseB F
(F G
optG J
)J K
{		 	
} 	
public 
DbSet 
< 
Client 
> 
Clients $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
DbSet 
< 
Venue 
> 
Venues "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} Ú
6E:\Work\Repos\EventEase\UserService\Data\ClientRepo.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

class 

ClientRepo 
: 
IClientRepo )
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public		 

ClientRepo		 
(		 
AppDbContext		 &
context		' .
)		. /
{

 	
_context 
= 
context 
; 
} 	
public 
void 
CreateClient  
(  !
Client! '
client( .
). /
{ 	
if 
( 
client 
is 
null 
) 
{ 
throw 
new !
ArgumentNullException /
(/ 0
nameof0 6
(6 7
client7 =
)= >
)> ?
;? @
} 
_context 
. 
Clients 
. 
Add  
(  !
client! '
)' (
;( )
} 	
public 
IEnumerable 
< 
Client !
>! "
GetAllClients# 0
(0 1
)1 2
{ 	
return 
_context 
. 
Clients #
.# $
ToList$ *
(* +
)+ ,
;, -
} 	
public 
Client 
GetClientById #
(# $
int$ '
id( *
)* +
{ 	
return 
_context 
. 
Clients #
.# $
FirstOrDefault$ 2
(2 3
c3 4
=>5 7
c8 9
.9 :
Id: <
=== ?
id@ B
)B C
;C D
}   	
public"" 
Client"" 
GetClientByEmail"" &
(""& '
string""' -
email"". 3
)""3 4
{## 	
return$$ 
_context$$ 
.$$ 
Clients$$ #
.$$# $
FirstOrDefault$$$ 2
($$2 3
c$$3 4
=>$$5 7
c$$8 9
.$$9 :
Email$$: ?
==$$@ B
email$$C H
)$$H I
;$$I J
}%% 	
public'' 
bool'' 
SaveChanges'' 
(''  
)''  !
{(( 	
return)) 
()) 
_context)) 
.)) 
SaveChanges)) (
())( )
)))) *
>=))+ -
$num)). /
)))/ 0
;))0 1
}** 	
public,, 
void,, 
UpdateClient,,  
(,,  !
Client,,! '
client,,( .
),,. /
{-- 	
_context.. 
... 
Clients.. 
... 
Update.. #
(..# $
client..$ *
)..* +
;..+ ,
}// 	
public11 
void11 
DeleteClient11  
(11  !
Client11! '
client11( .
)11. /
{22 	
_context33 
.33 
Clients33 
.33 
Remove33 #
(33# $
client33$ *
)33* +
;33+ ,
}44 	
}55 
}66 ı
7E:\Work\Repos\EventEase\UserService\Data\IClientRepo.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

	interface 
IClientRepo  
{ 
bool 
SaveChanges 
( 
) 
; 
IEnumerable		 
<		 
Client		 
>		 
GetAllClients		 )
(		) *
)		* +
;		+ ,
Client 
GetClientById 
( 
int  
id! #
)# $
;$ %
Client 
GetClientByEmail 
(  
string  &
email' ,
), -
;- .
void 
CreateClient 
( 
Client  
client! '
)' (
;( )
void 
UpdateClient 
( 
Client  
client! '
)' (
;( )
void 
DeleteClient 
( 
Client  
client! '
)' (
;( )
} 
} ‡
6E:\Work\Repos\EventEase\UserService\Data\IVenueRepo.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

	interface 

IVenueRepo 
{ 
bool 
SaveChanges 
( 
) 
; 
IEnumerable		 
<		 
Venue		 
>		 
GetAllVenues		 '
(		' (
)		( )
;		) *
Venue 
GetVenueById 
( 
int 
id !
)! "
;" #
void 
CreateVenue 
( 
Venue 
venue $
)$ %
;% &
void 
UpdateVenue 
( 
Venue 
venue $
)$ %
;% &
void 
DeleteVenue 
( 
Venue 
venue $
)$ %
;% &
} 
} ã$
2E:\Work\Repos\EventEase\UserService\Data\PrepDb.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

static 
class 
PrepDb 
{ 
public 
static 
void 
PrepPopulation )
() *
IApplicationBuilder* =
app> A
,A B
boolC G
isProdH N
)N O
{ 	
using		 
(		 
var		 
serviceScope		 #
=		$ %
app		& )
.		) *
ApplicationServices		* =
.		= >
CreateScope		> I
(		I J
)		J K
)		K L
{

 
SeedData 
( 
serviceScope %
.% &
ServiceProvider& 5
.5 6

GetService6 @
<@ A
AppDbContextA M
>M N
(N O
)O P
,P Q
isProdR X
)X Y
;Y Z
} 
} 	
private 
static 
void 
SeedData $
($ %
AppDbContext% 1
context2 9
,9 :
bool; ?
isProd@ F
)F G
{ 	
if 
( 
! 
context 
. 
Clients 
.  
Any  #
(# $
)$ %
||& (
!) *
context* 1
.1 2
Venues2 8
.8 9
Any9 <
(< =
)= >
)> ?
{   
if!! 
(!! 
!!! 
context!! 
.!! 
Clients!! #
.!!# $
Any!!$ '
(!!' (
)!!( )
)!!) *
{"" 
Console## 
.## 
	WriteLine## %
(##% &
$str##& D
)##D E
;##E F
context%% 
.%% 
Clients%% #
.%%# $
AddRange%%$ ,
(%%, -
new&& 
Client&& "
(&&" #
)&&# $
{&&% &

ExternalId&&& 0
=&&0 1
$str&&1 W
,&&W X
Name&&Y ]
=&&] ^
$str&&^ j
,&&j k
Email&&l q
=&&q r
$str	&&r Ü
}
&&Ü á
,
&&á à
new'' 
Client'' "
(''" #
)''# $
{''% &

ExternalId''& 0
=''0 1
$str''1 7
,''7 8
Name''9 =
=''= >
$str''> M
,''M N
Email''O T
=''T U
$str''U p
}''p q
,''q r
new(( 
Client(( "
(((" #
)((# $
{((% &

ExternalId((& 0
=((0 1
$str((1 8
,((8 9
Name((: >
=((> ?
$str((? J
,((J K
Email((L Q
=((Q R
$str((R i
}((i j
,((j k
new)) 
Client)) "
())" #
)))# $
{))% &

ExternalId))& 0
=))0 1
$str))1 8
,))8 9
Name)): >
=))> ?
$str))? L
,))L M
Email))N S
=))S T
$str))T m
}))m n
)** 
;** 
}++ 
if-- 
(-- 
!-- 
context-- 
.-- 
Venues-- "
.--" #
Any--# &
(--& '
)--' (
)--( )
{.. 
Console// 
.// 
	WriteLine// %
(//% &
$str//& C
)//C D
;//D E
context11 
.11 
Venues11 "
.11" #
AddRange11# +
(11+ ,
new33 
Venue33 !
(33! "
)33" #
{33$ %

ExternalId33% /
=33/ 0
$str330 V
,33V W
Name33X \
=33\ ]
$str33] p
,33p q
Email33r w
=33w x
$str	33x í
,
33í ì
PhoneNumber
33î ü
=
33ü †
$str
33° ¥
,
33¥ µ
Address
33∂ Ω
=
33Ω æ
$str
33æ “
,
33“ ”
City
33‘ ÿ
=
33ÿ Ÿ
$str
33Ÿ Â
}
33Â Ê
)55 
;55 
}66 
context99 
.99 
SaveChanges99 #
(99# $
)99$ %
;99% &
}:: 
else;; 
{<< 
Console== 
.== 
	WriteLine== !
(==! "
$str==" 5
)==5 6
;==6 7
}>> 
}?? 	
}@@ 
}AA ï
5E:\Work\Repos\EventEase\UserService\Data\VenueRepo.cs
	namespace 	
UserService
 
. 
Data 
{ 
public 

class 
	VenueRepo 
: 

IVenueRepo '
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public		 
	VenueRepo		 
(		 
AppDbContext		 %
context		& -
)		- .
{

 	
_context 
= 
context 
; 
} 	
public 
void 
CreateVenue 
(  
Venue  %
venue& +
)+ ,
{ 	
if 
( 
venue 
is 
null 
) 
{ 
throw 
new !
ArgumentNullException /
(/ 0
nameof0 6
(6 7
venue7 <
)< =
)= >
;> ?
} 
_context 
. 
Venues 
. 
Add 
(  
venue  %
)% &
;& '
} 	
public 
IEnumerable 
< 
Venue  
>  !
GetAllVenues" .
(. /
)/ 0
{ 	
return 
_context 
. 
Venues "
." #
ToList# )
() *
)* +
;+ ,
} 	
public 
Venue 
GetVenueById !
(! "
int" %
id& (
)( )
{ 	
return 
_context 
. 
Venues "
." #
FirstOrDefault# 1
(1 2
v2 3
=>4 6
v7 8
.8 9
Id9 ;
==< >
id? A
)A B
;B C
}   	
public"" 
bool"" 
SaveChanges"" 
(""  
)""  !
{## 	
return$$ 
($$ 
_context$$ 
.$$ 
SaveChanges$$ (
($$( )
)$$) *
>=$$+ -
$num$$. /
)$$/ 0
;$$0 1
}%% 	
public'' 
void'' 
UpdateVenue'' 
(''  
Venue''  %
venue''& +
)''+ ,
{(( 	
_context)) 
.)) 
Venues)) 
.)) 
Update)) "
())" #
venue))# (
)))( )
;))) *
}** 	
public,, 
void,, 
DeleteVenue,, 
(,,  
Venue,,  %
venue,,& +
),,+ ,
{-- 	
_context.. 
... 
Venues.. 
... 
Remove.. "
(.." #
venue..# (
)..( )
;..) *
}// 	
}00 
}11 Ë
9E:\Work\Repos\EventEase\UserService\Events\UserCreated.cs
	namespace 	
MessageBusEvents
 
. 
Models !
{ 
public 

class 
UserCreated 
{ 
public 
string 
Id 
{ 
get 
; 
set  #
;# $
}$ %
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Role 
{ 
get  
;  !
set" %
;% &
}' (
}		 
}

 ü
9E:\Work\Repos\EventEase\UserService\Events\UserDeleted.cs
	namespace 	
MessageBusEvents
 
. 
Models !
{ 
public 

class 
UserDeleted 
{ 
public 
string 
Id 
{ 
get 
; 
set  #
;# $
}% &
} 
} ¥
KE:\Work\Repos\EventEase\UserService\Extensions\ClaimsPrincipleExtensions.cs
	namespace 	
UserService
 
. 

Extensions  
{ 
public 
static 
class %
ClaimsPrincipleExtensions .
{ 
public 
static	 
string 
GetId 
( 
this !
ClaimsPrincipal" 1
	principal2 ;
); <
{ 
var 
userIdClaim 
= 
	principal 
. 
	FindFirst (
(( )
c) *
=>+ -
c. /
./ 0
Type0 4
==5 7
$str8 <
)< =
;= >
if 
( 
userIdClaim 
!= 
null 
&& 
! 
string %
.% &
IsNullOrEmpty& 3
(3 4
userIdClaim4 ?
.? @
Value@ E
)E F
)F G
{ 
return 

userIdClaim 
. 
Value 
; 
} 
return 	
null
 
; 
} 
public 
static	 
string 
GetRoles 
(  
this  $
ClaimsPrincipal% 4
	principal5 >
)> ?
{ 
var 
userRoleClaim 
= 
	principal  
.  !
	FindFirst! *
(* +
c+ ,
=>- /
c0 1
.1 2
Type2 6
==7 9

ClaimTypes: D
.D E
RoleE I
)I J
??K M
	principalN W
.W X
	FindFirstX a
(a b
cb c
=>d f
cg h
.h i
Typei m
==n p
$strq w
)w x
;x y
if 
( 
userRoleClaim 
!= 
null 
&& 
!  !
string! '
.' (
IsNullOrEmpty( 5
(5 6
userRoleClaim6 C
.C D
ValueD I
)I J
)J K
{   
return!! 

userRoleClaim!! 
.!! 
Value!! 
;!! 
}"" 
return$$ 	
null$$
 
;$$ 
}%% 
}&& 
}'' ü
4E:\Work\Repos\EventEase\UserService\Models\Client.cs
	namespace 	
UserService
 
. 
Models 
{ 
public 

class 
Client 
: 
UserBase "
{ 
} 
} ê
@E:\Work\Repos\EventEase\UserService\Models\Dtos\ClientReadDto.cs
	namespace 	
UserService
 
. 
Models 
. 
Dtos !
{ 
public 

class 
ClientReadDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
public		 
string		 
?		 
Email		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
}

 
} ç
BE:\Work\Repos\EventEase\UserService\Models\Dtos\ClientUpdateDto.cs
	namespace 	
UserService
 
. 
Models 
. 
Dtos !
{ 
public 

class 
ClientUpdateDto  
{ 
[ 	
Required	 
] 
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
}

 
} ç

?E:\Work\Repos\EventEase\UserService\Models\Dtos\VenueReadDto.cs
	namespace 	
UserService
 
. 
Models 
. 
Dtos !
{ 
public 

class 
VenueReadDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
Email 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
? 
PhoneNumber "
{# $
get% (
;( )
set* -
;- .
}/ 0
public		 
string		 
?		 
Address		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public

 
string

 
?

 
City

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
} 
} ä
AE:\Work\Repos\EventEase\UserService\Models\Dtos\VenueUpdateDto.cs
	namespace 	
UserService
 
. 
Models 
. 
Dtos !
{ 
public 

class 
VenueUpdateDto 
{ 
[ 	
Required	 
] 
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
public		 
string		 
?		 
PhoneNumber		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
public

 
string

 
?

 
Address

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
public 
string 
? 
City 
{ 
get !
;! "
set# &
;& '
}( )
} 
} å	
6E:\Work\Repos\EventEase\UserService\Models\UserBase.cs
	namespace 	
UserService
 
. 
Models 
{ 
public 

class 
UserBase 
{ 
[ 	
Key	 
] 
[ 	
Required	 
] 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
[ 	
Required	 
] 
public 
string 
? 

ExternalId !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Required	 
] 
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
Required	 
] 
public 
string 
? 
Email 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ú
3E:\Work\Repos\EventEase\UserService\Models\Venue.cs
	namespace 	
UserService
 
. 
Models 
{ 
public 

class 
Venue 
: 
UserBase !
{ 
public 
string 
? 
PhoneNumber "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
? 
Address 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
string		 
?		 
City		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
}

 
}  
<E:\Work\Repos\EventEase\UserService\Profiles\UsersProfile.cs
	namespace 	
UserService
 
. 
Profiles 
{ 
public 

class 
UsersProfile 
: 
Profile  '
{		 
public

 
UsersProfile

 
(

 
)

 
{ 	
	CreateMap 
< 
Client 
, 
ClientReadDto +
>+ ,
(, -
)- .
;. /
	CreateMap 
< 
Venue 
, 
VenueReadDto )
>) *
(* +
)+ ,
;, -
	CreateMap 
< 
UserCreated !
,! "
Venue# (
>( )
() *
)* +
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (

ExternalId( 2
,2 3
opt4 7
=>8 :
opt 
. 
MapFrom 
(  
src  #
=>$ &
src' *
.* +
Id+ -
)- .
) 
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Id( *
,* +
opt 
=> 
opt 
. 
Ignore %
(% &
)& '
) 
; 
	CreateMap 
< 
UserCreated !
,! "
Client# )
>) *
(* +
)+ ,
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (

ExternalId( 2
,2 3
opt4 7
=>8 :
opt 
. 
MapFrom 
(  
src  #
=>$ &
src' *
.* +
Id+ -
)- .
) 
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
Id( *
,* +
opt 
=> 
opt 
. 
Ignore %
(% &
)& '
) 
; 
	CreateMap!! 
<!! 
Venue!! 
,!! 
UserDeleted!! (
>!!( )
(!!) *
)!!* +
."" 
	ForMember"" 
("" 
dest"" 
=>""  "
dest""# '
.""' (
Id""( *
,""* +
opt"", /
=>""0 2
opt## 
.## 
MapFrom## 
(##  
src##  #
=>##$ &
src##' *
.##* +

ExternalId##+ 5
)##5 6
)$$ 
;$$ 
	CreateMap&& 
<&& 
Client&& 
,&& 
UserDeleted&& )
>&&) *
(&&* +
)&&+ ,
.'' 
	ForMember'' 
('' 
dest'' 
=>''  "
dest''# '
.''' (
Id''( *
,''* +
opt'', /
=>''0 2
opt(( 
.(( 
MapFrom(( 
(((  
src((  #
=>(($ &
src((' *
.((* +

ExternalId((+ 5
)((5 6
))) 
;)) 
}** 	
},, 
}-- ±;
.E:\Work\Repos\EventEase\UserService\Program.cs
var

 
builder

 
=

 
WebApplication

 
.

 
CreateBuilder

 *
(

* +
args

+ /
)

/ 0
;

0 1
string 
rabbitMQ 
= 
$str 
; 
if 
( 
builder 

.
 
Environment 
. 
IsProduction #
(# $
)$ %
)% &
{& '
Console 
. 
	WriteLine 
( 
$str 0
)0 1
;1 2
} 
else 
{ 
rabbitMQ 
= 
$" 
$str $
{$ %
builder% ,
., -
Configuration- :
[: ;
$str; I
]I J
}J K
$strK L
{L M
builderM T
.T U
ConfigurationU b
[b c
$strc q
]q r
}r s
"s t
;t u
Console 
. 
	WriteLine 
( 
$str ,
), -
;- .
builder 
. 
Services 
. 
AddDbContext !
<! "
AppDbContext" .
>. /
(/ 0
opt0 3
=>4 6
opt 
. 
UseInMemoryDatabase 
(  
$str  '
)' (
) 
; 
} 
builder   
.   
Services   
.   
AddAutoMapper   
(   
	AppDomain   (
.  ( )
CurrentDomain  ) 6
.  6 7
GetAssemblies  7 D
(  D E
)  E F
)  F G
;  G H
builder## 
.## 
Services## 
.## 
AddMassTransit## 
(##  
config##  &
=>##' )
{##* +
config%% 

.%%
 
AddConsumer%% 
<%% 
UserCreatedConsumer%% *
>%%* +
(%%+ ,
)%%, -
;%%- .
config'' 

.''
 -
!SetKebabCaseEndpointNameFormatter'' ,
('', -
)''- .
;''. /
config)) 

.))
 
UsingRabbitMq)) 
()) 
()) 
ctx)) 
,)) 
cfg)) "
)))" #
=>))$ &
{))' (
Console** 	
.**	 

	WriteLine**
 
(** 
rabbitMQ** 
)** 
;** 
cfg++ 
.++ 
Host++ 
(++ 
rabbitMQ++ 
)++ 
;++ 
cfg.. 
... 
ReceiveEndpoint.. 
(.. 
$str.. 3
,..3 4
c..5 6
=>..7 9
{..: ;
c00 
.00 
ConfigureConsumer00 
<00  
UserCreatedConsumer00  3
>003 4
(004 5
ctx005 8
)008 9
;009 :
}11 	
)11	 

;11
 
}22 
)22 
;22 
}33 
)33 
;33 
builder66 
.66 
Services66 
.66 
	AddScoped66 
<66 
IClientRepo66 &
,66& '

ClientRepo66( 2
>662 3
(663 4
)664 5
;665 6
builder77 
.77 
Services77 
.77 
	AddScoped77 
<77 

IVenueRepo77 %
,77% &
	VenueRepo77' 0
>770 1
(771 2
)772 3
;773 4
builder:: 
.:: 
Services:: 
.:: 
AddControllers:: 
(::  
)::  !
;::! "
builder<< 
.<< 
Services<< 
.<< #
AddEndpointsApiExplorer<< (
(<<( )
)<<) *
;<<* +
builder== 
.== 
Services== 
.== 
AddSwaggerGen== 
(== 
)==  
;==  !
builder@@ 
.@@ 
Services@@ 
.@@ 
AddAuthentication@@ "
(@@" #
options@@# *
=>@@+ -
{AA 
optionsBB 
.BB %
DefaultAuthenticateSchemeBB )
=BB* +
JwtBearerDefaultsBB, =
.BB= > 
AuthenticationSchemeBB> R
;BBR S
optionsCC 
.CC 
DefaultSchemeCC 
=CC 
JwtBearerDefaultsCC  1
.CC1 2 
AuthenticationSchemeCC2 F
;CCF G
optionsDD 
.DD "
DefaultChallengeSchemeDD &
=DD' (
JwtBearerDefaultsDD) :
.DD: ; 
AuthenticationSchemeDD; O
;DDO P
}EE 
)EE 
.FF 
AddJwtBearerFF 
(FF 
jwtFF 
=>FF 
{GG 
varHH 
keyHH 
=HH 
EncodingHH 
.HH 
ASCIIHH  
.HH  !
GetBytesHH! )
(HH) *
builderHH* 1
.HH1 2
ConfigurationHH2 ?
.HH? @

GetSectionHH@ J
(HHJ K
$strHHK ]
)HH] ^
.HH^ _
ValueHH_ d
)HHd e
;HHe f
jwtII 
.II 
	SaveTokenII 
=II 
trueII 
;II 
jwtKK 
.KK %
TokenValidationParametersKK %
=KK& '
newKK( +%
TokenValidationParametersKK, E
(KKE F
)KKF G
{LL 	$
ValidateIssuerSigningKeyMM $
=MM% &
trueMM' +
,MM+ ,
IssuerSigningKeyNN 
=NN 
newNN " 
SymmetricSecurityKeyNN# 7
(NN7 8
keyNN8 ;
)NN; <
,NN< =
ValidateIssuerOO 
=OO 
falseOO "
,OO" #
ValidateAudiencePP 
=PP 
falsePP $
,PP$ %!
RequireExpirationTimeQQ !
=QQ" #
falseQQ$ )
,QQ) *
ValidateLifetimeRR 
=RR 
trueRR #
}SS 	
;SS	 

}TT 
)TT 
;TT 
builderVV 
.VV 
ServicesVV 
.VV 
AddAuthorizationVV !
(VV! "
)VV" #
;VV# $
varXX 
appXX 
=XX 	
builderXX
 
.XX 
BuildXX 
(XX 
)XX 
;XX 
if[[ 
([[ 
app[[ 
.[[ 
Environment[[ 
.[[ 
IsDevelopment[[ !
([[! "
)[[" #
)[[# $
{\\ 
app]] 
.]] 

UseSwagger]] 
(]] 
)]] 
;]] 
app^^ 
.^^ 
UseSwaggerUI^^ 
(^^ 
)^^ 
;^^ 
}__ 
PrepDbaa 
.aa 
PrepPopulationaa 
(aa 
appaa 
,aa 
appaa 
.aa 
Environmentaa *
.aa* +
IsProductionaa+ 7
(aa7 8
)aa8 9
)aa9 :
;aa: ;
appcc 
.cc 
UseHttpsRedirectioncc 
(cc 
)cc 
;cc 
appee 
.ee 
UseAuthorizationee 
(ee 
)ee 
;ee 
appgg 
.gg 
MapControllersgg 
(gg 
)gg 
;gg 
appii 
.ii 
Runii 
(ii 
)ii 	
;ii	 
